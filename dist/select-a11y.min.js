define(["jquery"],function(e){return{transform:function(){e("select[data-select-a11y]").each(function(t,a){!function(t){var a,n,s,i,o=t.attr("id"),l=((i=t.parent()).addClass("tag-hidden"),i.attr("aria-hidden","true"),i.find("select").attr("tabindex","-1"),i),d=(l.wrap('<div class="select-a11y"></div>'),l.parent()),r=function(){var a=t.data("placeholder"),n=e('<div class="a11y-container">  <div class="a11y-container-inner">    <p id="a11y-usage'+o+'-js" class="sr-only">Utilisez la tabulation (ou la touche flèche du bas) pour naviguer dans la liste des suggestions</p>    <label for="a11y-'+o+'-js" class="sr-only">'+a+'</label>    <input type="text" id="a11y-'+o+'-js" autocomplete="off" autocapitalize="off" spellcheck="false"          placeholder="'+a+'" aria-describedby="a11y-usage'+o+'-js">    <div id="a11y-'+o+'-suggestions" class="a11y-suggestions">      <div role="listbox">      </div>    </div>  </div></div>'),s=n.find("#a11y-"+o+"-js");return i(n,l.attr("class")),i(s,t.attr("class")),n.insertBefore(l),n;function i(e,t){var a=t.split(/\s+/);a.forEach(function(t){e.addClass(t)})}}(),u=(n=l.find("label"),(s=e('<button type="button" class="btn btn-select-a11y" aria-expanded="false">'+n.text()+'<span class="icon-select" aria-hidden="true"></span></button>')).insertBefore(r),r.addClass("tag-hidden"),s),c=(a=e('<div aria-live="polite" class="sr-only">  <p></p></div>'),a.insertBefore(u),a).find("p");function f(a,n){var s=r.next().next(),i=e('<li>  <span id="'+o+"-"+a+'" class="tag-item" data-value="'+n+'">'+n+'    <button class="tag-item-supp" title="supprimer '+n+'" type="button">      <span class="sr-only">supprimer</span>      <span class="icon-delete" aria-hidden="true"></span>    </button>  </span></li>');s.append(i),i.find("button").on("click",function(a){var n,s,i,o,l=e(a.currentTarget),d=l.parent().parent();n=l,s=t.val()||[],i=n.parent().data("value"),o=s.indexOf(i),s.splice(o,1),t.val(s);var r=d.prev();r.length>0?r.find("button").focus():u.focus(),c.empty(),d.remove()})}(function(){var a=e('<ul class="list-inline list-selected"></ul>');a.insertAfter(l);var n=t.find(":selected");n.length>0&&n.each(function(e,t){f(t.index,t.value)})})(),function(){var a=e("#a11y-"+o+"-suggestions div"),n=r.find("#a11y-"+o+"-js");function s(){var s=t.find("option").filter(function(e,t){return t.value.toLowerCase().indexOf(n.val().toLowerCase())>-1});if(a.empty(),0===s.length){var i="aucun résultat";c.text(i);var o=e('<div   class="a11y-no-suggestion">'+i+"</div>");a.append(o)}else s.each(function(t,n){var s=e("<div   data-id="+n.index+'  class="a11y-suggestion"  tabindex="-1"  role="option">'+n.value+"</div>");a.append(s)}),c.text(s.length+" suggestions disponibles")}function i(e){a.empty(),r.addClass("tag-hidden"),u.attr("aria-expanded","false"),d.removeClass("is-open"),n.val(""),e&&(u.focus(),e.preventDefault())}function l(s){var l=a.find(".a11y-suggestion").first(),d=a.find(".a11y-suggestion").last(),r=e(s.currentTarget),u=r.prev(),p=r.next();function v(e,t){e.length>0?e.focus():t.focus()}s.shiftKey||9!==s.keyCode||(p.length>0?(p.focus(),s.preventDefault()):(i(),c.empty())),40===s.keyCode&&(v(p,l),s.preventDefault()),38===s.keyCode&&(v(u,d),s.preventDefault()),s.shiftKey&&9===s.keyCode&&(v(u,n),s.preventDefault()),27===s.keyCode&&(i(s),c.empty()),function(){if("click"===s.type||13===s.keyCode){var a=e("#"+o+"-"+r.data("id")).length>0;a?c.text(r.text()+" déjà sélectionné"):(f(r.data("id"),r.text()),n=r.text(),(l=t.val()||[]).push(n),t.val(l),c.text(r.text()+" sélectionné")),i(s)}var n,l}()}e("body").on("click",function(t){var s=e(t.target);s.is(n)||s.is(a.parent())||s.is(a)||s.is(".a11y-suggestion")||s.is(u)||(i(),c.empty())}),d.on("focusout",function(){var t=e(this);setTimeout(function(){0===t.find(":focus").length&&c.empty()},10)}),u.on("click",function(e){d.hasClass("is-open")?(i(e),c.empty()):(d.addClass("is-open"),r.removeClass("tag-hidden"),r.find(":text").focus(),u.attr("aria-expanded","true"),s())}),n.on("keyup",s).on("keydown",function(e){var t=a.find(".a11y-suggestion"),n=!e.shiftKey&&9===e.keyCode,s=e.shiftKey&&9===e.keyCode,o=40===e.keyCode,l=27===e.keyCode;(n||o)&&t.length>0&&(t.first().focus(),e.preventDefault()),n&&0===t.length&&i(),(l||s)&&(i(e),c.empty())}),a.on("keydown",".a11y-suggestion",l),a.on("click",".a11y-suggestion",l)}()}(e(a))})}}});