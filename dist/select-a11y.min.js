var Select=function(){"use strict";function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var l={help:"Utilisez la tabulation (ou la touche flèche du bas) pour naviguer dans la liste des suggestions",placeholder:"Rechercher dans la liste",noResult:"aucun résultat",results:"{x} suggestion(s) disponibles",deleteItem:"supprimer {t}",delete:"supprimer"},i=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,a=Element.prototype.closest;return a||(function(e){throw new Error('"'+e+'" is read-only')}("closest"),a=function(e){var t=this;do{if(i.call(t,e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}),function(){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.el=e,this.label=document.querySelector("label[for=".concat(e.id,"]")),this.id=e.id,this.open=!1,this.multiple=this.el.multiple,this.search="",this.suggestions=[],this.focusIndex=null;var i=Object.assign({},t),s=Object.assign(l,i.text);delete i.text,this._options=Object.assign({text:s,showSelected:!0},i),this._handleFocus=this._handleFocus.bind(this),this._handleInput=this._handleInput.bind(this),this._handleKeyboard=this._handleKeyboard.bind(this),this._handleOpener=this._handleOpener.bind(this),this._handleReset=this._handleReset.bind(this),this._handleSuggestionClick=this._handleSuggestionClick.bind(this),this._removeOption=this._removeOption.bind(this),this._disable(),this.button=this._createButton(),this.liveZone=this._createLiveZone(),this.overlay=this._createOverlay(),this.wrap=this._wrap(),this.multiple&&this._options.showSelected&&(this.selectedList=this._createSelectedList(),this._updateSelectedList(),this.selectedList.addEventListener("click",this._removeOption)),this.button.addEventListener("click",this._handleOpener),this.input.addEventListener("input",this._handleInput),this.list.addEventListener("click",this._handleSuggestionClick),this.wrap.addEventListener("keydown",this._handleKeyboard),document.addEventListener("blur",this._handleFocus,!0),this.el.form.addEventListener("reset",this._handleReset)}return function(e,t,i){t&&s(e.prototype,t),i&&s(e,i)}(n,[{key:"_createButton",value:function(){var e=document.createElement("button");e.setAttribute("type","button"),e.setAttribute("aria-expanded",this.open),e.className="btn btn-select-a11y";var t=document.createElement("span");if(this.multiple)t.innerText=this.label.innerText;else{var i=this.el.item(this.el.selectedIndex);t.innerText=i.label||i.value}return e.appendChild(t),e.insertAdjacentHTML("beforeend",'<span class="icon-select" aria-hidden="true"></span>'),e}},{key:"_createLiveZone",value:function(){var e=document.createElement("p");return e.setAttribute("aria-live","polite"),e.classList.add("sr-only"),e}},{key:"_createOverlay",value:function(){var e=document.createElement("div");e.classList.add("a11y-container");var t=document.createElement("div");return t.classList.add("a11y-suggestions"),t.id="a11y-".concat(this.id,"-suggestions"),e.innerHTML='\n      <p id="a11y-usage$'.concat(this.id,'-js" class="sr-only">').concat(this._options.text.help,'</p>\n      <label for="a11y-').concat(this.id,'-js" class="sr-only">').concat(this._options.text.placeholder,'</label>\n      <input type="text" id="a11y-').concat(this.id,'-js" class="').concat(this.el.className,'" autocomplete="off" autocapitalize="off" spellcheck="false" placeholder="').concat(this._options.text.placeholder,'" aria-describedby="a11y-usage').concat(this.id,'-js">\n    '),e.appendChild(t),this.list=t,this.input=e.querySelector("input"),e}},{key:"_createSelectedList",value:function(){var e=document.createElement("ul");return e.className="list-inline list-selected",e}},{key:"_disable",value:function(){this.el.setAttribute("tabindex",-1)}},{key:"_fillSuggestions",value:function(){var s=this.search.toLowerCase();this.suggestions=Array.prototype.map.call(this.el.options,function(e,t){if(-1!==(e.label||e.value).toLowerCase().indexOf(s)){var i=document.createElement("div");return i.setAttribute("role","option"),i.setAttribute("tabindex",0),i.setAttribute("data-index",t),i.classList.add("a11y-suggestion"),-1!==Array.prototype.indexOf.call(this.el.selectedOptions,e)&&i.setAttribute("aria-selected","true"),i.innerText=e.label||e.value,i}}.bind(this)).filter(Boolean),this.suggestions.length?(this.list.innerHTML='<div role="listbox"><div>',this.suggestions.forEach(function(e){this.list.firstElementChild.appendChild(e)}.bind(this))):this.list.innerHTML='<p class="a11y-no-suggestion">'.concat(this._options.text.noResult,"</p>"),this._setLiveZone()}},{key:"_handleOpener",value:function(e){this._toggleOverlay()}},{key:"_handleFocus",value:function(){this.open&&(clearTimeout(this._focusTimeout),this._focusTimeout=setTimeout(function(){if(this.wrap.contains(document.activeElement))if(document.activeElement===this.input)this.focusIndex=null;else{var e=this.suggestions.indexOf(document.activeElement);-1!==e&&(this.focusIndex=e)}else this._toggleOverlay(!1)}.bind(this),10))}},{key:"_handleReset",value:function(){clearTimeout(this._resetTimeout),this._resetTimeout=setTimeout(function(){this._fillSuggestions(),this.multiple&&this._options.showSelected&&this._updateSelectedList()}.bind(this),10)}},{key:"_handleSuggestionClick",value:function(e){var t=a.call(e.target,'[role="option"]');t&&this._toggleSelection(parseInt(t.getAttribute("data-index"),10))}},{key:"_handleInput",value:function(){this.search=this.input.value,this._fillSuggestions()}},{key:"_handleKeyboard",value:function(e){var t=a.call(e.target,'[role="option"]'),i=a.call(e.target,"input");27!==e.keyCode?i&&13===e.keyCode?e.preventDefault():39!==e.keyCode&&40!==e.keyCode?t&&(37!==e.keyCode&&38!==e.keyCode?13!==e.keyCode&&32!==e.keyCode||this._toggleSelection(parseInt(t.getAttribute("data-index"),10)):this._moveIndex(-1)):this._moveIndex(1):this._toggleOverlay()}},{key:"_moveIndex",value:function(e){if(null===this.focusIndex)this.focusIndex=0;else{var t=this.focusIndex+e,i=this.suggestions.length-1;this.focusIndex=i<t?0:t<0?i:t}this.suggestions[this.focusIndex].focus()}},{key:"_removeOption",value:function(e){var t=a.call(e.target,"button");if(t){var i=parseInt(t.getAttribute("data-index"),10);if(this._toggleSelection(i),this.selectedList.parentElement){var s=this.selectedList.querySelector("button");s?s.focus():this.button.focus()}else this.button.focus()}}},{key:"_setButtonText",value:function(e){this.button.firstElementChild.innerText=e}},{key:"_setLiveZone",value:function(){var e=this.suggestions.length,t="";this.open&&(t=e?this._options.text.results.replace("{x}",e):this._options.text.noResult),this.liveZone.innerText=t}},{key:"_toggleOverlay",value:function(e){this.open=void 0!==e?e:!this.open,this.button.setAttribute("aria-expanded",this.open),this.open?(this._fillSuggestions(),this.button.insertAdjacentElement("afterend",this.overlay),this.input.focus()):this.wrap.contains(this.overlay)&&(this.wrap.removeChild(this.overlay),this.focusIndex=null,this.input.value="",this.search="",this._setLiveZone(),void 0===e&&setTimeout(function(){this.button.focus()}.bind(this)))}},{key:"_toggleSelection",value:function(e){var t=this.el.item(e);this.multiple?this.el.item(e).selected=!this.el.item(e).selected:this.el.selectedIndex=e,this.suggestions.forEach(function(e){var t=parseInt(e.getAttribute("data-index"),10);this.el.item(t).selected?e.setAttribute("aria-selected","true"):e.removeAttribute("aria-selected")}.bind(this)),this.multiple?this._options.showSelected&&this._updateSelectedList():(this._setButtonText(t.label||t.value),this._toggleOverlay())}},{key:"_updateSelectedList",value:function(){var e=Array.prototype.map.call(this.el.options,function(e,t){if(e.selected){var i=e.label||e.value;return'\n        <li class="tag-item">\n          <span>'.concat(i,'</span>\n          <button class="tag-item-supp" title="').concat(this._options.text.deleteItem.replace("{t}",i),'" type="button" data-index="').concat(t,'">\n            <span class="sr-only">').concat(this._options.text.delete,'</span>\n            <span class="icon-delete" aria-hidden="true"></span>\n          </button>\n        </li>')}}.bind(this)).filter(Boolean);this.selectedList.innerHTML=e.join(""),e.length?this.selectedList.parentElement||this.wrap.appendChild(this.selectedList):this.wrap.removeChild(this.selectedList)}},{key:"_wrap",value:function(){var e=document.createElement("div");e.classList.add("select-a11y"),this.el.parentElement.appendChild(e);var t=document.createElement("div");return t.classList.add("tag-hidden"),t.setAttribute("aria-hidden",!0),this.multiple&&t.appendChild(this.label),t.appendChild(this.el),e.appendChild(t),e.appendChild(this.liveZone),e.appendChild(this.button),e}}]),n}()}();
